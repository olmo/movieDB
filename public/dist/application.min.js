"use strict";function init(){window.addEventListener("scroll",function(){var a=window.pageYOffset||document.documentElement.scrollTop,b=50,c=document.querySelector(".navbar");a>b?classie.add(c,"fixed"):classie.has(c,"fixed")&&classie.remove(c,"fixed")})}var ApplicationConfiguration=function(){var a="moviedb",b=["ngResource","ngCookies","ngAnimate","ngTouch","ngSanitize","ui.router","ui.bootstrap","ui.utils"],c=function(b){angular.module(b,[]),angular.module(a).requires.push(b)};return{applicationModuleName:a,applicationModuleVendorDependencies:b,registerModule:c}}();angular.module(ApplicationConfiguration.applicationModuleName,ApplicationConfiguration.applicationModuleVendorDependencies),angular.module(ApplicationConfiguration.applicationModuleName).config(["$locationProvider",function(a){a.hashPrefix("!")}]),angular.element(document).ready(function(){"#_=_"===window.location.hash&&(window.location.hash="#!"),angular.bootstrap(document,[ApplicationConfiguration.applicationModuleName])}),ApplicationConfiguration.registerModule("articles"),ApplicationConfiguration.registerModule("core"),ApplicationConfiguration.registerModule("movies"),ApplicationConfiguration.registerModule("people"),ApplicationConfiguration.registerModule("users"),angular.module("articles").run(["Menus",function(){}]),angular.module("articles").config(["$stateProvider",function(a){a.state("listArticles",{url:"/articles",templateUrl:"modules/articles/views/list-articles.client.view.html"}).state("createArticle",{url:"/articles/create",templateUrl:"modules/articles/views/create-article.client.view.html"}).state("viewArticle",{url:"/articles/:articleId",templateUrl:"modules/articles/views/view-article.client.view.html"}).state("editArticle",{url:"/articles/:articleId/edit",templateUrl:"modules/articles/views/edit-article.client.view.html"})}]),angular.module("articles").controller("ArticlesController",["$scope","$stateParams","$location","Authentication","Articles",function(a,b,c,d,e){a.authentication=d,a.create=function(){var b=new e({title:this.title,content:this.content});b.$save(function(a){c.path("articles/"+a._id)},function(b){a.error=b.data.message}),this.title="",this.content=""},a.remove=function(b){if(b){b.$remove();for(var d in a.articles)a.articles[d]===b&&a.articles.splice(d,1)}else a.article.$remove(function(){c.path("articles")})},a.update=function(){var b=a.article;b.$update(function(){c.path("articles/"+b._id)},function(b){a.error=b.data.message})},a.find=function(){a.articles=e.query()},a.findOne=function(){a.article=e.get({articleId:b.articleId})}}]),angular.module("articles").factory("Articles",["$resource",function(a){return a("articles/:articleId",{articleId:"@_id"},{update:{method:"PUT"}})}]),angular.module("core").config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/"),a.state("home",{url:"/home",templateUrl:"modules/core/views/home.client.view.html"})}]),angular.module("core").controller("HeaderController",["$scope","Authentication","Menus",function(a,b,c){a.authentication=b,a.isCollapsed=!1,a.menu=c.getMenu("topbar"),a.toggleCollapsibleMenu=function(){a.isCollapsed=!a.isCollapsed},a.$on("$stateChangeSuccess",function(){a.isCollapsed=!1})}]),angular.module("core").controller("HomeController",["$scope","Authentication",function(a,b){a.authentication=b}]),angular.module("core").service("Menus",[function(){this.defaultRoles=["user"],this.menus={};var a=function(a){if(!a)return this.isPublic;for(var b in a.roles)for(var c in this.roles)if(this.roles[c]===a.roles[b])return!0;return!1};this.validateMenuExistance=function(a){if(a&&a.length){if(this.menus[a])return!0;throw new Error("Menu does not exists")}throw new Error("MenuId was not provided")},this.getMenu=function(a){return this.validateMenuExistance(a),this.menus[a]},this.addMenu=function(b,c,d){return this.menus[b]={isPublic:c||!1,roles:d||this.defaultRoles,items:[],shouldRender:a},this.menus[b]},this.removeMenu=function(a){this.validateMenuExistance(a),delete this.menus[a]},this.addMenuItem=function(b,c,d,e,f,g,h){return this.validateMenuExistance(b),this.menus[b].items.push({title:c,link:d,menuItemType:e||"item",menuItemClass:e,uiRoute:f||"/"+d,isPublic:g||this.menus[b].isPublic,roles:h||this.defaultRoles,items:[],shouldRender:a}),this.menus[b]},this.addSubMenuItem=function(b,c,d,e,f,g,h){this.validateMenuExistance(b);for(var i in this.menus[b].items)this.menus[b].items[i].link===c&&this.menus[b].items[i].items.push({title:d,link:e,uiRoute:f||"/"+e,isPublic:g||this.menus[b].isPublic,roles:h||this.defaultRoles,shouldRender:a});return this.menus[b]},this.removeMenuItem=function(a,b){this.validateMenuExistance(a);for(var c in this.menus[a].items)this.menus[a].items[c].link===b&&this.menus[a].items.splice(c,1);return this.menus[a]},this.removeSubMenuItem=function(a,b){this.validateMenuExistance(a);for(var c in this.menus[a].items)for(var d in this.menus[a].items[c].items)this.menus[a].items[c].items[d].link===b&&this.menus[a].items[c].items.splice(d,1);return this.menus[a]},this.addMenu("topbar",!0)}]),angular.module("movies").run(["Menus",function(a){a.addMenuItem("topbar","Movies","movies","dropdown","/movies(/create)?"),a.addSubMenuItem("topbar","movies","List Movies","movies"),a.addSubMenuItem("topbar","movies","New Movie","movies/create")}]),angular.module("movies").config(["$stateProvider",function(a){a.state("listMovies",{url:"/",templateUrl:"modules/movies/views/list-movies.client.view.html"}).state("createMovie",{url:"/movies/create",templateUrl:"modules/movies/views/create-movie.client.view.html"}).state("viewMovie",{url:"/movies/:movieId",templateUrl:"modules/movies/views/view-movie.client.view.html"}).state("editMovie",{url:"/movies/:movieId/edit",templateUrl:"modules/movies/views/edit-movie.client.view.html"})}]),angular.module("movies").controller("MoviesController",["$scope","$stateParams","$location","$http","Authentication","Movies",function(a,b,c,d,e,f){a.authentication=e,a.create=function(){var b=new f({name:this.name});b.$save(function(a){c.path("movies/"+a._id)},function(b){a.error=b.data.message}),this.name=""},a.searchTmdb=function(){var b={query:this.query};d.post("/searchTmdb",b).success(function(b){a.searchMovies=b.results})},a.addMovie=function(b){var c={id:b};d.post("/addFromTmdb",c).success(function(b){a.searchMovies=b.results})},a.remove=function(b){if(b){b.$remove();for(var d in a.movies)a.movies[d]===b&&a.movies.splice(d,1)}else a.movie.$remove(function(){c.path("movies")})},a.update=function(){var b=a.movie;b.$update(function(){c.path("movies/"+b._id)},function(b){a.error=b.data.message})},a.find=function(){a.movies=f.query()},a.findOne=function(){a.movie=f.get({movieId:b.movieId})}}]),angular.module("movies").directive("isotope",[function(){return{link:function(a){a.$watch("$last",function(a){if(a){var b=$(".fix-portfolio .items");b.imagesLoaded(function(){b.isotope({itemSelector:".item"})}),$(window).on("resize",function(){b.isotope("reLayout")})}})}}}]),angular.module("movies").factory("Movies",["$resource",function(a){return a("movies/:movieId",{movieId:"@_id"},{update:{method:"PUT"}})}]),angular.module("people").run(["Menus",function(a){a.addMenuItem("topbar","People","people","dropdown","/people(/create)?"),a.addSubMenuItem("topbar","people","List People","people"),a.addSubMenuItem("topbar","people","New Person","people/create")}]),angular.module("people").config(["$stateProvider",function(a){a.state("listPeople",{url:"/people",templateUrl:"modules/people/views/list-people.client.view.html"}).state("createPerson",{url:"/people/create",templateUrl:"modules/people/views/create-person.client.view.html"}).state("viewPerson",{url:"/people/:personId",templateUrl:"modules/people/views/view-person.client.view.html"}).state("editPerson",{url:"/people/:personId/edit",templateUrl:"modules/people/views/edit-person.client.view.html"})}]),angular.module("people").controller("PeopleController",["$scope","$stateParams","$location","Authentication","People",function(a,b,c,d,e){a.authentication=d,a.create=function(){var b=new e({name:this.name});b.$save(function(a){c.path("people/"+a._id)},function(b){a.error=b.data.message}),this.name=""},a.remove=function(b){if(b){b.$remove();for(var d in a.people)a.people[d]===b&&a.people.splice(d,1)}else a.person.$remove(function(){c.path("people")})},a.update=function(){var b=a.person;b.$update(function(){c.path("people/"+b._id)},function(b){a.error=b.data.message})},a.find=function(){a.people=e.query()},a.findOne=function(){a.person=e.get({personId:b.personId})}}]),angular.module("people").factory("People",["$resource",function(a){return a("people/:personId",{personId:"@_id"},{update:{method:"PUT"}})}]),angular.module("users").config(["$httpProvider",function(a){a.interceptors.push(["$q","$location","Authentication",function(a,b,c){return{responseError:function(d){switch(d.status){case 401:c.user=null,b.path("signin");break;case 403:}return a.reject(d)}}}])}]),angular.module("users").config(["$stateProvider",function(a){a.state("profile",{url:"/settings/profile",templateUrl:"modules/users/views/settings/edit-profile.client.view.html"}).state("password",{url:"/settings/password",templateUrl:"modules/users/views/settings/change-password.client.view.html"}).state("accounts",{url:"/settings/accounts",templateUrl:"modules/users/views/settings/social-accounts.client.view.html"}).state("signup",{url:"/signup",templateUrl:"modules/users/views/signup.client.view.html"}).state("signin",{url:"/signin",templateUrl:"modules/users/views/signin.client.view.html"})}]),angular.module("users").controller("AuthenticationController",["$scope","$http","$location","Authentication",function(a,b,c,d){a.authentication=d,a.authentication.user&&c.path("/"),a.signup=function(){b.post("/auth/signup",a.credentials).success(function(b){a.authentication.user=b,c.path("/")}).error(function(b){a.error=b.message})},a.signin=function(){b.post("/auth/signin",a.credentials).success(function(b){a.authentication.user=b,c.path("/")}).error(function(b){a.error=b.message})}}]),angular.module("users").controller("SettingsController",["$scope","$http","$location","Users","Authentication",function(a,b,c,d,e){a.user=e.user,a.user||c.path("/"),a.hasConnectedAdditionalSocialAccounts=function(){for(var b in a.user.additionalProvidersData)return!0;return!1},a.isConnectedSocialAccount=function(b){return a.user.provider===b||a.user.additionalProvidersData&&a.user.additionalProvidersData[b]},a.removeUserSocialAccount=function(c){a.success=a.error=null,b.delete("/users/accounts",{params:{provider:c}}).success(function(b){a.success=!0,a.user=e.user=b}).error(function(b){a.error=b.message})},a.updateUserProfile=function(){a.success=a.error=null;var b=new d(a.user);b.$update(function(b){a.success=!0,e.user=b},function(b){a.error=b.data.message})},a.changeUserPassword=function(){a.success=a.error=null,b.post("/users/password",a.passwordDetails).success(function(){a.success=!0,a.passwordDetails=null}).error(function(b){a.error=b.message})}}]),angular.module("users").factory("Authentication",[function(){var a=this;return a._data={user:window.user},a._data}]),angular.module("users").factory("Users",["$resource",function(a){return a("users",{},{update:{method:"PUT"}})}]),window.onload=init(),$(document).ready(function(){$(".offset").css("padding-top",$(".navbar").height()+"px")}),$(window).resize(function(){$(".offset").css("padding-top",$(".navbar").height()+"px")});